<div class="app-container">
  <nav class="navbar">
    <div class="logo">
      <a routerLink="/" class="logo-link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="logo-icon">
          <path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
        </svg>
        <span>GameLibrary</span>
      </a>
    </div>

    <div class="controls-container desktop-controls">
      <a class="nav-link" routerLink="/platforms">Plataformas</a>
    </div>

    <div class="auth-controls desktop-controls">
      @if (isAuthenticated$ | async) {
        <div class="profile-dropdown" #profileMenu>
          <button class="profile-button" (click)="toggleProfileMenu($event)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="profile-icon">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            @if (currentUser$ | async; as user) {
              <span>{{ user.username }}</span>
            }
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="dropdown-arrow" [class.rotated]="isProfileMenuOpen">
              <path d="M7 10l5 5 5-5z"/>
            </svg>
          </button>
          @if (isProfileMenuOpen) {
            <div class="dropdown-menu">
              <button class="dropdown-item" (click)="logout()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="dropdown-icon">
                  <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                </svg>
                <span>Logout</span>
              </button>
            </div>
          }
        </div>
      } @else {
        <button class="auth-button login" (click)="openLoginModal()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="auth-icon">
            <path d="M11 7l-1.41 1.41L12.17 11H2v2h10.17l-2.58 2.58L11 17l5-5zM20 19h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
          </svg>
          <span>Login</span>
        </button>
      }
    </div>

    <div class="mobile-menu-button">
      <button (click)="toggleMobileMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </svg>
      </button>
    </div>
  </nav>

  @if (isMobileMenuOpen) {
    <div class="mobile-menu-overlay" (click)="closeMobileMenu()">
      <div class="mobile-menu" (click)="stopPropagation($event)">
        <div class="mobile-menu-header">
          <h2>Menú</h2>
          <button (click)="closeMobileMenu()" class="close-button">&times;</button>
        </div>
        <div class="mobile-menu-content">
          <a class="nav-link" routerLink="/platforms" (click)="closeMobileMenu()">Plataformas</a>
          <div class="auth-controls">
            @if (isAuthenticated$ | async) {
              <div class="profile-dropdown" #profileMenuMobile>
                <button class="profile-button" (click)="toggleProfileMenu($event)">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="profile-icon">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                  </svg>
                  @if (currentUser$ | async; as user) {
                    <span>{{ user.username }}</span>
                  }
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="dropdown-arrow" [class.rotated]="isProfileMenuOpen">
                    <path d="M7 10l5 5 5-5z"/>
                  </svg>
                </button>
                @if (isProfileMenuOpen) {
                  <div class="dropdown-menu">
                    <button class="dropdown-item" (click)="logout()">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="dropdown-icon">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                      </svg>
                      <span>Logout</span>
                    </button>
                  </div>
                }
              </div>
            } @else {
              <button class="auth-button login" (click)="openLoginModal()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="auth-icon">
                  <path d="M11 7l-1.41 1.41L12.17 11H2v2h10.17l-2.58 2.58L11 17l5-5zM20 19h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
                </svg>
                <span>Login</span>
              </button>
            }
          </div>
        </div>
      </div>
    </div>
  }

  <main class="main-content">
    <router-outlet></router-outlet>
  </main>

  <footer class="footer">
    <p>Copyright © 2026 Francisco José Soler Conchello. Todos los derechos reservados.</p>
  </footer>

  @if (selectedGame) {
    <app-game-detail-modal [game]="selectedGame" (close)="selectedGame = null"></app-game-detail-modal>
  }
  @if (showLoginModal) {
    <div class="modal-overlay" (click)="closeLoginModal()">
      <div class="modal-content login-modal-content" (click)="stopPropagation($event)">
        <button class="close-button" (click)="closeLoginModal()" aria-label="Cerrar login">&times;</button>
        <app-login
          (switchToRegister)="openRegisterModal()"
          (loginSuccess)="closeLoginModal()"
        ></app-login>
      </div>
    </div>
  }
  @if (showRegisterModal) {
    <div class="modal-overlay" (click)="closeRegisterModal()">
      <div class="modal-content login-modal-content" (click)="stopPropagation($event)">
        <button class="close-button" (click)="closeRegisterModal()" aria-label="Cerrar registro">&times;</button>
        <app-register
          (registerSuccess)="closeRegisterModal()"
          (switchToLogin)="openLoginModal(); closeRegisterModal()"
        ></app-register>
      </div>
    </div>
  }
</div>
