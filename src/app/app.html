<div class="app-container">
  <nav class="navbar">
    <div class="logo">
      <a routerLink="/" class="logo-link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="logo-icon">
          <path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
        </svg>
        <span>GameLibrary</span>
      </a>
    </div>

    <div class="auth-controls desktop-controls">
      <a class="nav-link" routerLink="/platforms">Plataformas</a>
      @if (isAuthenticated$ | async) {
        <a class="nav-link" routerLink="/library">Mi Biblioteca</a>
      }
      <app-auth-widget
        [isAuthenticated]="isAuthenticated$ | async"
        [currentUser]="currentUser$ | async"
        (login)="uiService.openLoginModal()"
        (logout)="logout()"
      ></app-auth-widget>
    </div>

    <div class="mobile-menu-button">
      <button (click)="uiService.toggleMobileMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </svg>
      </button>
    </div>
  </nav>

  @if (isMobileMenuOpen$ | async) {
    <div class="mobile-menu-overlay" role="button" tabindex="0" (click)="uiService.closeMobileMenu()" (keydown.enter)="uiService.closeMobileMenu()" aria-label="Cerrar menú">
      <div class="mobile-menu" (click)="uiService.stopPropagation($event)">
        <div class="mobile-menu-header">
          <h2>Menú</h2>
          <button (click)="uiService.closeMobileMenu()" class="close-button" aria-label="Cerrar menú" title="Cerrar menú">
            &times;
          </button>
        </div>
        <div class="mobile-menu-content">
          <a class="nav-link" routerLink="/platforms" (click)="uiService.closeMobileMenu()">Plataformas</a>
          @if (isAuthenticated$ | async) {
            <a class="nav-link" routerLink="/library" (click)="uiService.closeMobileMenu()">Mi Biblioteca</a>
          }
          <div class="auth-controls">
            <app-auth-widget
              [isAuthenticated]="isAuthenticated$ | async"
              [currentUser]="currentUser$ | async"
              [isMobileView]="true"
              (login)="uiService.openLoginModal()"
              (logout)="logout()"
              (closeMenu)="uiService.closeMobileMenu()"
            ></app-auth-widget>
          </div>
        </div>
      </div>
    </div>
  }

  <main class="main-content">
    <router-outlet></router-outlet>
  </main>

  <footer class="footer">
    <p>Copyright © 2026 Francisco José Soler Conchello. Todos los derechos reservados.</p>
  </footer>

  @if (selectedGame$ | async; as selectedGame) {
    <app-game-detail-modal
      [gameId]="selectedGame.id"
      [platforms]="selectedGame.platforms"
      (closeModalEvent)="uiService.closeGameModal()"
    ></app-game-detail-modal>
  }
  @if (showLoginModal$ | async) {
    <div class="modal-overlay" role="button" tabindex="0" (click)="uiService.closeLoginModal()" (keydown.enter)="uiService.closeLoginModal()" aria-label="Cerrar modal">
      <div class="modal-content login-modal-content" (click)="uiService.stopPropagation($event)">
        <button class="close-button" (click)="uiService.closeLoginModal()" aria-label="Cerrar login" title="Cerrar login">
          &times;
        </button>
        <app-login
          (switchToRegister)="uiService.openRegisterModal()"
          (loginSuccess)="uiService.closeLoginModal()"
        ></app-login>
      </div>
    </div>
  }
  @if (showRegisterModal$ | async) {
    <div class="modal-overlay" role="button" tabindex="0" (click)="uiService.closeRegisterModal()" (keydown.enter)="uiService.closeRegisterModal()" aria-label="Cerrar modal">
      <div class="modal-content login-modal-content" (click)="uiService.stopPropagation($event)">
        <button class="close-button" (click)="uiService.closeRegisterModal()" aria-label="Cerrar registro" title="Cerrar registro">
          &times;
        </button>
        <app-register
          (registerSuccess)="uiService.closeRegisterModal()"
          (switchToLogin)="uiService.openLoginModal()"
        ></app-register>
      </div>
    </div>
  }
</div>
<app-toast-container></app-toast-container>
