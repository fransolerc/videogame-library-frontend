<div class="library-container">
  <div class="library-header">
    <h1>Mi Biblioteca</h1>
  </div>

  <div class="home-controls">
    <div class="filter-container">
      <svg class="filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" />
      </svg>
      <select class="sort-select" (change)="onSortChange($event)">
        <option value="relevance">Ordenar por</option>
        <option value="name-asc">Nombre (A-Z)</option>
        <option value="name-desc">Nombre (Z-A)</option>
        <option value="date-desc">Lanzamiento (nuevos)</option>
        <option value="date-asc">Lanzamiento (antiguos)</option>
        <option value="rating-desc">Puntuación</option>
      </select>
    </div>
    <div class="filter-container">
      <svg class="filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M5 2a1 1 0 00-1 1v1.586l-2.293 2.293A1 1 0 002.414 8H6v6H5a1 1 0 00-1 1v1a1 1 0 102 0v-1h2v1a1 1 0 102 0v-1h1v4a1 1 0 102 0v-4h1a1 1 0 100-2h-1V8h3.586a1 1 0 00.707-1.707L16 4.586V3a1 1 0 00-1-1H5zm5 5a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z" clip-rule="evenodd" />
      </svg>
      <select class="sort-select" (change)="onPlatformFilterChange($event)">
        <option value="all">Todas las plataformas</option>
        @if (platforms$ | async; as platforms) {
          @for (platform of platforms; track platform.id) {
            <option [value]="platform.id">{{ platform.name }}</option>
          }
        }
      </select>
    </div>
  </div>

  @if (isLoading) {
    <div class="skeleton-container">
      @for (i of [].constructor(4); track i) {
        <div class="game-section">
          <div class="horizontal-scroll-container">
            <ul class="game-list">
              @for (j of [].constructor(5); track j) {
                <li class="game-list-item">
                  <app-game-card-skeleton></app-game-card-skeleton>
                </li>
              }
            </ul>
          </div>
        </div>
      }
    </div>
  } @else {
    @if (favorites.length > 0) {
      <section class="game-section">
        <h2 class="section-title">
          <svg class="section-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
          </svg>
          Favoritos
        </h2>
        <div class="horizontal-scroll-container">
          <ul class="game-list" #favoritesList>
            @for (game of favorites; track game.id) {
              <button class="game-list-item" (click)="openGameModal(game)">
                <app-game-card [game]="game" [isPlatformClickable]="false"></app-game-card>
              </button>
            }
          </ul>
        </div>
      </section>
    }

    @if (wantToPlay.length > 0) {
      <section class="game-section">
        <h2 class="section-title">
          <svg class="section-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z" clip-rule="evenodd" />
          </svg>
          Quiero Jugar
        </h2>
        <div class="horizontal-scroll-container">
          <ul class="game-list" #wantToPlayList>
            @for (game of wantToPlay; track game.id) {
              <button class="game-list-item" (click)="openGameModal(game)">
                <app-game-card [game]="game" [isPlatformClickable]="false"></app-game-card>
              </button>
            }
          </ul>
        </div>
      </section>
    }

    @if (playing.length > 0) {
      <section class="game-section">
        <h2 class="section-title">
          <svg class="section-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm14.024-.983a1.125 1.125 0 010 1.966l-5.604 3.113A1.125 1.125 0 019 15.113V8.887c0-.857.921-1.4 1.619-.983l5.604 3.113z" clip-rule="evenodd" />
          </svg>
          Jugando
        </h2>
        <div class="horizontal-scroll-container">
          <ul class="game-list" #playingList>
            @for (game of playing; track game.id) {
              <button class="game-list-item" (click)="openGameModal(game)">
                <app-game-card [game]="game" [isPlatformClickable]="false"></app-game-card>
              </button>
            }
          </ul>
        </div>
      </section>
    }

    @if (completed.length > 0) {
      <section class="game-section">
        <h2 class="section-title">
          <svg class="section-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
          </svg>
          Completados
        </h2>
        <div class="horizontal-scroll-container">
          <ul class="game-list" #completedList>
            @for (game of completed; track game.id) {
              <button class="game-list-item" (click)="openGameModal(game)">
                <app-game-card [game]="game" [isPlatformClickable]="false"></app-game-card>
              </button>
            }
          </ul>
        </div>
      </section>
    }

    @if (favorites.length === 0 && wantToPlay.length === 0 && playing.length === 0 && completed.length === 0) {
      <div class="empty-library-message">
        <p>Tu biblioteca está vacía.</p>
        <p>Añade juegos desde la página principal para verlos aquí.</p>
      </div>
    } @else {
      <section class="game-section">
        <h2 class="section-title">
          <svg class="section-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6h-6z"/>
          </svg>
          Estadísticas de Favoritos
        </h2>
        <app-statistics></app-statistics>
      </section>
    }
  }
</div>
