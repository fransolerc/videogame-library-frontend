<div class="home-container">
  <div class="home-controls">
    <div class="search-bar">
      <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
      </svg>
      <input class="search-input" type="text" (input)="onSearch($event)" placeholder="Buscar juego..." aria-label="Buscar juego">
      @if (isSearching$ | async) {
        <button class="clear-button" (click)="clearSearch()" aria-label="Borrar búsqueda">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      }
    </div>

    <div class="filter-container">
      <svg class="filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
      </svg>
      <select id="sort-by" class="sort-select" (change)="onSortChange($event)" aria-label="Ordenar por">
        <option value="relevance">Relevancia</option>
        <option value="name-asc">Nombre (A-Z)</option>
        <option value="name-desc">Nombre (Z-A)</option>
        <option value="date-desc">Fecha (Nuevos)</option>
        <option value="date-asc">Fecha (Antiguos)</option>
        <option value="rating-desc">Valoración (Mejores)</option>
      </select>
    </div>

    <div class="filter-container">
      <svg class="filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7v2H8v2h8v-2h-2v-2h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H3V4h18v12z"/>
      </svg>
      <select id="platform-filter" class="sort-select" (change)="onPlatformFilterChange($event)" aria-label="Filtrar por plataforma">
        <option value="all">Todas las plataformas</option>
        @if (platforms$ | async; as platforms) {
          @for (platform of platforms; track platform.id) {
            <option [value]="platform.id">{{ platform.name }}</option>
          }
        }
      </select>
    </div>
  </div>

  @if (isSearching$ | async) {
    <div class="section-container">
      <h2 class="section-title">Resultados para "{{ lastSearchTerm }}"</h2>
      @if (searchResults$ | async; as games) {
        @if (hasResults) {
          <div class="latest-releases-scroll-list" #searchResultsList>
            @for (game of games; track game.id) {
              <app-game-card class="game-item" [game]="game" (click)="openModal(game)" (platformClick)="navigateToPlatformPage($event)"></app-game-card>
            }
          </div>
        } @else {
          <div class="no-results">
            <p>No se encontraron juegos para "<strong>{{ lastSearchTerm }}</strong>"</p>
          </div>
        }
      }
    </div>
  }

  @if (isAuthenticated$ | async) {
    @if (sortedFavorites$ | async; as games) {
      @if (games.length > 0) {
        <div class="section-container">
          <div class="section-header">
            <h2 class="section-title">Mis Favoritos</h2>
            <div class="filter-container">
              <svg class="filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
              </svg>
              <select id="favorites-sort-by" class="sort-select" (change)="onFavoritesSortChange($event)" aria-label="Ordenar favoritos por">
                <option value="name-asc">Nombre (A-Z)</option>
                <option value="name-desc">Nombre (Z-A)</option>
                <option value="date-desc">Fecha (Nuevos)</option>
                <option value="date-asc">Fecha (Antiguos)</option>
                <option value="rating-desc">Valoración (Mejores)</option>
              </select>
            </div>
          </div>
          <div class="latest-releases-scroll-list" #favoritesList>
            @for (game of games; track game.id) {
              <app-game-card class="game-item" [game]="game" (click)="openModal(game)" (platformClick)="navigateToPlatformPage($event)"></app-game-card>
            }
          </div>
        </div>
      }
    }
  }

  <div class="section-container">
    <h2 class="section-title">Últimos Lanzamientos</h2>
    @if (latestGames$ | async; as games) {
      <div class="latest-releases-scroll-list" #latestReleasesList>
        @for (game of games; track game.id) {
          <app-game-card class="game-item" [game]="game" (click)="openModal(game)" (platformClick)="navigateToPlatformPage($event)"></app-game-card>
        }
      </div>
    }
  </div>
</div>
